# ============================================================
# 机器人基础配置
# ============================================================
[bot]
# 机器人昵称（用于日志显示和自我称呼）
nickname = "月代雪"

# 命令触发前缀（例如：/help、/chat）
command_start = [ "/",]

# 管理员 QQ 号列表（拥有管理权限的用户）
admin_id = [ 3265312545,]

# 群组 ID 列表（预留字段，暂未使用）
group_id = []

# ============================================================
# 存储与记忆系统配置
# ============================================================
[storage]
# === 向量数据库配置（FAISS 长期记忆） ===
# 向量数据库存储路径（存储用户对话的向量索引）
vector_db_path = "./data/memory_v2"

# 每次检索返回的记忆条数
retrieve_count = 10

# 向量相似度阈值（0-1，越高越严格，低于此值的记忆不会被召回）
similarity_threshold = 0.3

# 最小记忆长度（字符数，短于此长度的对话不会被存储）
min_memory_length = 5

# 每个用户最多存储的记忆条数（超出后会删除最旧的记忆）
max_memory_per_user = 500

# 是否启用向量记忆功能
enable_vector_memory = true

# 记忆内容最大 token 数（用于控制传递给 AI 的记忆长度）
max_memory_tokens = 500

# === 知识库配置 ===
# 知识库检索相似度阈值（用于从 knowledge_docs 构建的知识库中检索）
kb_similarity_threshold = 0.3

# 知识库内容最大 token 数（控制传递给 AI 的知识库内容长度）
max_kb_tokens = 400

# === RAG 知识图谱配置 ===
# 是否启用知识图谱功能（实体-关系图谱，用于结构化记忆）
enable_knowledge_graph = true

# 知识图谱数据库路径（SQLite 数据库）
graph_db_path = "./data/knowledge_graph.db"

# 图谱检索最大深度（关系跳数，越大检索范围越广但性能越低）
graph_max_depth = 2

# 图谱检索最大结果数（返回的实体/关系数量上限）
graph_max_results = 5

# ============================================================
# 白名单配置（访问控制）
# ============================================================
[bot.whitelist]
# 是否启用白名单功能（启用后只有白名单内的用户/群组可以使用机器人）
enable = true

# 是否允许所有私聊（true 则所有私聊都可用，false 则只允许 allowed_users）
allow_all_private = false

# 允许使用机器人的用户 QQ 号列表
allowed_users = [ 3265312545, 2876134022, 339719490, 1816730245, 2422863475, 2274429025, 3792281013, 1700520291, 1661818954, 3787845913, 851789278, 3374404184, 1284189433, 1198284461, 3566628040, 990154697, 2846487959, 1468371828, 530502865, 2010399634, 1026151551, 1935563952, 3284672873, 1276230787, 3678843602, 2442635064, 3973619352, 1689279846, 3570459491,]

# 允许使用机器人的群组号列表
allowed_groups = [ 123, 878880057, 1073417009, 835252320, 419929255, 1009825944, 716961277, 784346589, 1077476010, 626433574, 855032680,]

# ============================================================
# 回复策略配置（消息拆分与打字模拟）
# ============================================================
[bot.reply_strategy]
# 是否启用消息拆分（长消息会被拆分成多条发送，模拟真人打字）
enable_split = true

# 拆分阈值（字符数，超过此长度的消息会被拆分）
split_threshold = 8

# 最小分段长度（拆分后每段至少包含的字符数）
min_segment_length = 15

# 打字速度（秒/字，用于计算发送延迟，模拟真人打字速度）
typing_speed = 0.2

# 最大延迟时间（秒，单条消息的最大等待时间，避免过长等待）
max_delay = 3.0

# ============================================================
# 表情包功能配置
# ============================================================
[bot.emoji]
# 是否启用表情包学习（自动学习用户发送的表情包）
enable_learning = true

# 是否启用表情包发送（根据对话内容自动发送相关表情包）
enable_sending = true

# 发送表情包的概率（0-1，每次回复时有此概率发送表情包）
sending_probability = 0.2

# 表情包相似度阈值（用于检索相关表情包，越低越宽松）
similarity_threshold = 0.2

# 高相似度阈值（高于此值认为非常匹配，会优先发送）
high_similarity_threshold = 0.6

# 表情包存储路径（存储学习到的表情包图片）
storage_path = "./emoji"

# 每次检索返回的表情包数量
retrieve_count = 1

# 发送表情包的延迟时间（秒，在文字消息后等待此时间再发送表情包）
send_delay = 1.0

# ============================================================
# 注入攻击防护配置（防止用户通过特殊话术操控机器人行为）
# ============================================================
[bot.injection_guard]
# 是否启用注入防护功能
enable = true

# 检测到注入攻击后的黑名单时长（分钟，用户会被临时拉黑）
blacklist_minutes = 30

# 防护模型温度（越低越严格，建议使用低温度以提高检测准确性）
guard_temperature = 0.1

# 防护检测超时时间（秒，超时则跳过检测直接处理消息）
guard_timeout = 15

# 群聊中是否仅对 @机器人 的消息启用防护（true 则只检测 @消息）
enable_in_group_only_to_me = false

# 是否仅对白名单内的聊天启用防护（true 则只保护白名单用户）
enable_only_for_whitelisted_chat = false

# 跳过短消息检测的长度阈值（字符数，短于此长度的消息不检测，0 表示检测所有消息）
skip_short_message_length = 0
